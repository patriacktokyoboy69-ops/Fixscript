----------------------------------------------------------------
-- üõ°Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô Script ‡∏ã‡πâ‡∏≥
----------------------------------------------------------------
if _G.FARM_SCRIPT_RUNNING then
    warn("‚ö†Ô∏è Script ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ")
    warn("‚ö†Ô∏è ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡∏à‡∏≠‡∏¢‡∏ô‡πå‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô")
    return
end

_G.FARM_SCRIPT_RUNNING = true
print("‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Script - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥")

-- ‡∏•‡∏î wait time ‡∏à‡∏≤‡∏Å 20 ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
print("‚è≥ ‡∏£‡∏≠ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô...")
wait(1)

pcall(function()
    local mobRemote = game:GetService("ReplicatedStorage"):FindFirstChild("Remotes")
    if mobRemote then
        local target = mobRemote:FindFirstChild("MobDamageRemote")
        if target then
            target:Destroy()
            print("‚úÖ ‡∏•‡∏ö MobDamageRemote ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
        end
    end
end)

local Player = game.Players.LocalPlayer
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

-- ‚öôÔ∏è ‡πÑ‡∏≠‡∏î‡∏µ‡πÇ‡∏•‡∏Å
local FARM_WORLD = 125804922932357  -- ‡πÉ‡∏™‡πà PlaceId ‡∏Ç‡∏≠‡∏á‡πÇ‡∏•‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°
local SELL_WORLD = 3475397644       -- ‡πÉ‡∏™‡πà PlaceId ‡∏Ç‡∏≠‡∏á‡πÇ‡∏•‡∏Å‡∏Ç‡∏≤‡∏¢

-- ‡πÇ‡∏•‡∏Å‡∏™‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
local RANDOM_WORLDS = {
    3475419198, 3475422608, 3487210751,
    3623549100, 3737848045, 3752680052,
    4174118306, 4728805070
}

local NO_GO_ZONES = {
    {position = Vector3.new(-320.14263916015625, 88.54524230957031, -752.4129638671875), radius = 50},
    {position = Vector3.new(-394.253662109375, 867.26513671875, -5312.3798828125), radius = 50},
    {position = Vector3.new(1003.189453125, 308.4173583984375, 741.0112915039062), radius = 50},
    {position = Vector3.new(-2724.1591796875, 452.9313659667969, -988.661865234375), radius = 50},
}

-- ‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
local SELL_THRESHOLD = 10000
local autoFarm = true
local flySpeed = 350
local attackDelay = 0.3
local scanRange = 150

-- ‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á
local STUCK_CHECK_INTERVAL = 15
local STUCK_DISTANCE_THRESHOLD = 5
local MAX_STUCK_COUNT = 3

local itemNames = {
    "SpiritwoodResourcesModel",
    "LimestoneResourcesModel", 
    "MistCrystalResourcesModel"
}

-- ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏•‡∏≤‡∏î‡∏ï‡∏£‡∏∞‡πÄ‡∏ß‡∏ô
local checkPositions = {
    Vector3.new(-266, 467, -394), Vector3.new(1757, 783, 672),
    Vector3.new(1420, 319, -1409), Vector3.new(1922, 620, -2566),
    Vector3.new(2226, 585, -4128), Vector3.new(330, 901, -4304),
    Vector3.new(-1433, 779, -4717), Vector3.new(-3031, 780, -4211),
    Vector3.new(-2643, 547, -2250), Vector3.new(-857, 401, -2132),
    Vector3.new(-828, 688, -3444), Vector3.new(-1819, 405, 170),
}

local currentPatrolIndex = 1
local noclipConnection

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
local LocalPlayer = Player
local Character = nil
local HRP = nil

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á
local lastPosition = nil
local stuckCount = 0
local farmLoopActive = false
local farmCoroutine = nil

----------------------------------------------------------------
-- üõ°Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö Anti-AFK (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà - ‡∏Ç‡∏¢‡∏±‡∏ö‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥)
----------------------------------------------------------------
local antiAFKEnabled = true
local lastActionTime = tick()

local function setupAntiAFK()
    print("üõ°Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Anti-AFK")
    
    -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏à‡∏±‡∏ö Idled Event
    task.spawn(function()
        pcall(function()
            local vu = game:GetService("VirtualUser")
            Player.Idled:Connect(function()
                if antiAFKEnabled and _G.FARM_SCRIPT_RUNNING then
                    vu:CaptureController()
                    vu:ClickButton2(Vector2.new())
                    print("üõ°Ô∏è Anti-AFK: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Idle Kick")
                end
            end)
        end)
    end)
    
    -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏Ç‡∏¢‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏´‡∏•‡∏±‡∏Å)
    task.spawn(function()
        while antiAFKEnabled and _G.FARM_SCRIPT_RUNNING do
            task.wait(5) -- ‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            
            pcall(function()
                local char = Player.Character
                if char then
                    local hrp = char:FindFirstChild("HumanoidRootPart")
                    local humanoid = char:FindFirstChildOfClass("Humanoid")
                    
                    if hrp and humanoid then
                        -- ‡∏™‡∏∏‡πà‡∏°‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ç‡∏¢‡∏±‡∏ö
                        local method = math.random(1, 3)
                        
                        if method == 1 then
                            -- ‡∏ß‡∏¥‡∏ò‡∏µ 1: ‡∏Ç‡∏¢‡∏±‡∏ö HRP ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
                            local randomOffset = Vector3.new(
                                math.random(-3, 3) * 0.5,
                                0,
                                math.random(-3, 3) * 0.5
                            )
                            hrp.CFrame = hrp.CFrame * CFrame.new(randomOffset)
                            
                        elseif method == 2 then
                            -- ‡∏ß‡∏¥‡∏ò‡∏µ 2: ‡∏´‡∏°‡∏∏‡∏ô‡∏ï‡∏±‡∏ß
                            local randomAngle = math.rad(math.random(-45, 45))
                            hrp.CFrame = hrp.CFrame * CFrame.Angles(0, randomAngle, 0)
                            
                        else
                            -- ‡∏ß‡∏¥‡∏ò‡∏µ 3: ‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î
                            if humanoid.FloorMaterial ~= Enum.Material.Air then
                                humanoid.Jump = true
                            end
                        end
                        
                        lastActionTime = tick()
                    end
                end
            end)
        end
    end)
    
    -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏∏‡πà‡∏°‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    task.spawn(function()
        while antiAFKEnabled and _G.FARM_SCRIPT_RUNNING do
            task.wait(30)
            
            pcall(function()
                local vim = game:GetService("VirtualInputManager")
                local keys = {
                    Enum.KeyCode.W,
                    Enum.KeyCode.A,
                    Enum.KeyCode.S,
                    Enum.KeyCode.D
                }
                
                local randomKey = keys[math.random(1, #keys)]
                
                -- ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
                vim:SendKeyEvent(true, randomKey, false, game)
                task.wait(0.1)
                vim:SendKeyEvent(false, randomKey, false, game)
                
                lastActionTime = tick()
            end)
        end
    end)
    
    -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 4: ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏™‡∏∏‡πà‡∏°‡∏ó‡∏∏‡∏Å 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    task.spawn(function()
        while antiAFKEnabled and _G.FARM_SCRIPT_RUNNING do
            task.wait(60)
            
            pcall(function()
                local vu = game:GetService("VirtualUser")
                local randomPos = Vector2.new(math.random(1, 100), math.random(1, 100))
                
                vu:Button1Down(randomPos)
                task.wait(0.05)
                vu:Button1Up(randomPos)
                
                lastActionTime = tick()
            end)
        end
    end)
    
    -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 5: ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ó‡∏∏‡∏Å 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    task.spawn(function()
        while antiAFKEnabled and _G.FARM_SCRIPT_RUNNING do
            task.wait(15)
            
            pcall(function()
                local camera = workspace.CurrentCamera
                if camera then
                    -- ‡∏´‡∏°‡∏∏‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
                    local currentCF = camera.CFrame
                    local randomAngle = math.rad(math.random(-10, 10))
                    camera.CFrame = currentCF * CFrame.Angles(0, randomAngle, 0)
                    
                    task.wait(0.1)
                    
                    -- ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥
                    camera.CFrame = currentCF
                    
                    lastActionTime = tick()
                end
            end)
        end
    end)
    
    print("‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö Anti-AFK ‡∏û‡∏£‡πâ‡∏≠‡∏° (5 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô)")
    print("   üîÑ ‡∏Ç‡∏¢‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥")
    print("   ‚å®Ô∏è ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥")
    print("   üñ±Ô∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ó‡∏∏‡∏Å 60 ‡∏ß‡∏¥")
    print("   üìπ ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ó‡∏∏‡∏Å 15 ‡∏ß‡∏¥")
end

local function updateLastAction()
    lastActionTime = tick()
end

local function isInNoGoZone(pos)
    for _, zone in ipairs(NO_GO_ZONES) do
        if (pos - zone.position).Magnitude <= zone.radius then
            return true
        end
    end
    return false
end

local function setNoclip(state)
    if state then
        if noclipConnection then return end

        noclipConnection = RunService.Stepped:Connect(function()
            pcall(function()
                local char = LocalPlayer.Character
                if char then
                    for _, part in ipairs(char:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end)
        end)
    else
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end

        pcall(function()
            local char = LocalPlayer.Character
            if char then
                for _, part in ipairs(char:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = true
                    end
                end
            end
        end)
    end
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á
----------------------------------------------------------------
local function restartFarmSystem()
    warn("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°...")
    
    if farmCoroutine then
        pcall(function()
            coroutine.close(farmCoroutine)
        end)
        farmCoroutine = nil
    end
    
    farmLoopActive = false
    task.wait(2)
    
    stuckCount = 0
    lastPosition = nil
    currentPatrolIndex = 1
    
    warn("üîÑ ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏™‡∏£‡πá‡∏à - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà...")
    task.wait(1)
    startFarm()
end

local function startStuckDetection()
    print("üîç ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á")
    
    task.spawn(function()
        while autoFarm and _G.FARM_SCRIPT_RUNNING do
            task.wait(STUCK_CHECK_INTERVAL)
            
            if game.PlaceId ~= FARM_WORLD then
                continue
            end
            
            if not farmLoopActive then
                continue
            end
            
            pcall(function()
                local char = Player.Character
                if not char then return end
                
                local hrp = char:FindFirstChild("HumanoidRootPart")
                if not hrp then return end
                
                local currentPos = hrp.Position
                
                if lastPosition then
                    local distance = (currentPos - lastPosition).Magnitude
                    
                    print(string.format("üìç ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà: %.2f studs", distance))
                    
                    if distance < STUCK_DISTANCE_THRESHOLD then
                        stuckCount = stuckCount + 1
                        warn(string.format("‚ö†Ô∏è ‡∏ï‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á! (%d/%d)", stuckCount, MAX_STUCK_COUNT))
                        
                        if stuckCount >= MAX_STUCK_COUNT then
                            warn("üö® ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏£‡∏∞‡∏ö‡∏ö...")
                            restartFarmSystem()
                            task.wait(30)
                        end
                    else
                        if stuckCount > 0 then
                            print("‚úÖ ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏Å‡∏ï‡∏¥ - ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï")
                            stuckCount = 0
                        end
                    end
                end
                
                lastPosition = currentPos
            end)
        end
    end)
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö GUI
----------------------------------------------------------------
local function createGUI()
    pcall(function()
        if game.CoreGui:FindFirstChild("FarmGUI") then
            game.CoreGui.FarmGUI:Destroy()
        end
    end)
    
    local success = pcall(function()
        local screenGui = Instance.new("ScreenGui")
        screenGui.Name = "FarmGUI"
        screenGui.ResetOnSpawn = false
        screenGui.IgnoreGuiInset = true
        screenGui.Parent = game.CoreGui
        
        -- üí∞ ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏á‡∏¥‡∏ô
        local coinLabel = Instance.new("TextLabel")
        coinLabel.Name = "CoinLabel"
        coinLabel.Size = UDim2.new(0, 250, 0, 60)
        coinLabel.Position = UDim2.new(0.5, -125, 0.05, 0)
        coinLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        coinLabel.BackgroundTransparency = 0.3
        coinLabel.BorderSizePixel = 0
        coinLabel.TextColor3 = Color3.fromRGB(255, 223, 0)
        coinLabel.TextStrokeTransparency = 0.5
        coinLabel.TextScaled = true
        coinLabel.Font = Enum.Font.GothamBold
        coinLabel.Text = "üí∞ Loading..."
        coinLabel.Parent = screenGui
        
        local coinCorner = Instance.new("UICorner")
        coinCorner.CornerRadius = UDim.new(0, 12)
        coinCorner.Parent = coinLabel
        
        -- üì¶ ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
        local itemFrame = Instance.new("Frame")
        itemFrame.Name = "ItemFrame"
        itemFrame.Size = UDim2.new(0, 280, 0, 150)
        itemFrame.Position = UDim2.new(0.5, -140, 0.15, 0)
        itemFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        itemFrame.BackgroundTransparency = 0.3
        itemFrame.BorderSizePixel = 0
        itemFrame.Parent = screenGui
        
        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 12)
        frameCorner.Parent = itemFrame
        
        local resources = {
            {name = "Spiritwood", icon = "ü™µ", color = Color3.fromRGB(139, 90, 43)},
            {name = "Limestone", icon = "ü™®", color = Color3.fromRGB(200, 200, 200)},
            {name = "MistCrystal", icon = "üíé", color = Color3.fromRGB(100, 200, 255)}
        }
        
        for i, resource in ipairs(resources) do
            local label = Instance.new("TextLabel")
            label.Name = resource.name .. "Label"
            label.Size = UDim2.new(1, -20, 0, 40)
            label.Position = UDim2.new(0, 10, 0, (i-1) * 45 + 10)
            label.BackgroundTransparency = 1
            label.TextColor3 = resource.color
            label.TextStrokeTransparency = 0.5
            label.TextScaled = true
            label.Font = Enum.Font.GothamBold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Text = resource.icon .. " Loading..."
            label.Parent = itemFrame
        end
        
        -- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        local statusLabel = Instance.new("TextLabel")
        statusLabel.Name = "StatusLabel"
        statusLabel.Size = UDim2.new(0, 280, 0, 50)
        statusLabel.Position = UDim2.new(0.5, -140, 0.32, 0)
        statusLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        statusLabel.BackgroundTransparency = 0.3
        statusLabel.BorderSizePixel = 0
        statusLabel.TextColor3 = Color3.fromRGB(0, 255, 127)
        statusLabel.TextStrokeTransparency = 0.5
        statusLabel.TextScaled = true
        statusLabel.Font = Enum.Font.GothamBold
        statusLabel.Text = "‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥"
        statusLabel.Parent = screenGui
        
        local statusCorner = Instance.new("UICorner")
        statusCorner.CornerRadius = UDim.new(0, 12)
        statusCorner.Parent = statusLabel
        
        -- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        task.spawn(function()
            while task.wait(1) and _G.FARM_SCRIPT_RUNNING do
                pcall(function()
                    if stuckCount > 0 then
                        statusLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
                        statusLabel.Text = string.format("‚ö†Ô∏è ‡∏ï‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á: %d/%d", stuckCount, MAX_STUCK_COUNT)
                    else
                        statusLabel.TextColor3 = Color3.fromRGB(0, 255, 127)
                        statusLabel.Text = "‚úÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥"
                    end
                end)
            end
        end)
        
        -- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏á‡∏¥‡∏ô
        task.spawn(function()
            task.wait(2) -- ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î
            pcall(function()
                local coinsValue = Player:WaitForChild("Data", 10):WaitForChild("Currency", 10):WaitForChild("Coins", 10)
                local lastCoins = coinsValue.Value
                
                while task.wait(0.5) and _G.FARM_SCRIPT_RUNNING do
                    local current = coinsValue.Value
                    local diff = current - lastCoins
                    
                    if diff > 0 then
                        coinLabel.TextColor3 = Color3.fromRGB(0, 255, 127)
                    elseif diff < 0 then
                        coinLabel.TextColor3 = Color3.fromRGB(255, 80, 80)
                    else
                        coinLabel.TextColor3 = Color3.fromRGB(255, 223, 0)
                    end
                    
                    coinLabel.Text = string.format("üí∞ %s", tostring(current))
                    lastCoins = current
                end
            end)
        end)
        
        -- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
        task.spawn(function()
            task.wait(2) -- ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î
            pcall(function()
                local resourcesData = Player:WaitForChild("Data", 10):WaitForChild("Resources", 10)
                
                while task.wait(0.5) and _G.FARM_SCRIPT_RUNNING do
                    for i, resource in ipairs(resources) do
                        local val = resourcesData:FindFirstChild(resource.name)
                        if val then
                            local label = itemFrame:FindFirstChild(resource.name .. "Label")
                            if label then
                                label.Text = string.format("%s %s: %d", resource.icon, resource.name, val.Value)
                                
                                if val.Value >= SELL_THRESHOLD * 0.8 then
                                    label.TextColor3 = Color3.fromRGB(255, 165, 0)
                                elseif val.Value >= SELL_THRESHOLD then
                                    label.TextColor3 = Color3.fromRGB(255, 80, 80)
                                else
                                    label.TextColor3 = resource.color
                                end
                            end
                        end
                    end
                end
            end)
        end)
        
        print("‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á GUI ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    end)
    
    if not success then
        warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á GUI")
    end
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≤‡∏¢/‡∏ß‡∏≤‡∏£‡πå‡∏õ
----------------------------------------------------------------
local function sellAllItems()
    print("üí∞ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡∏≤‡∏¢‡πÑ‡∏≠‡πÄ‡∏ó‡∏°...")
    
    pcall(function()
        local resources = Player:WaitForChild("Data", 10):WaitForChild("Resources", 10)
        local itemsToSell = {"Spiritwood", "Limestone", "MistCrystal"}
        
        for _, item in ipairs(itemsToSell) do
            local val = resources:FindFirstChild(item)
            if val and val.Value > 0 then
                pcall(function()
                    local args = {{ItemName = item, Amount = val.Value}}
                    ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("SellItemRemote"):FireServer(unpack(args))
                    print("‚úÖ ‡∏Ç‡∏≤‡∏¢ " .. item .. ": " .. val.Value)
                end)
                task.wait(0.5)
            end
        end
    end)
    
    print("üí∞ ‡∏Ç‡∏≤‡∏¢‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!")
end

local function checkInventoryForSell()
    local result = false
    pcall(function()
        local resources = Player:WaitForChild("Data", 5):WaitForChild("Resources", 5)
        local spirit = resources:FindFirstChild("Spiritwood") and resources.Spiritwood.Value or 0
        local lime = resources:FindFirstChild("Limestone") and resources.Limestone.Value or 0
        local crystal = resources:FindFirstChild("MistCrystal") and resources.MistCrystal.Value or 0
        
        result = spirit >= SELL_THRESHOLD or lime >= SELL_THRESHOLD or crystal >= SELL_THRESHOLD
    end)
    return result
end

local function teleportToWorld(placeId)
    print("üåç ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ:", placeId)
    pcall(function()
        ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("WorldTeleportRemote"):InvokeServer(placeId, {})
    end)
end

local function teleportToRandomWorld()
    local randomWorld = RANDOM_WORLDS[math.random(1, #RANDOM_WORLDS)]
    print("üé≤ ‡∏™‡∏∏‡πà‡∏°‡∏ß‡∏≤‡∏£‡πå‡∏õ:", randomWorld)
    teleportToWorld(randomWorld)
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏ô‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà: ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡∏Ñ‡∏ô)
----------------------------------------------------------------
local MAX_PLAYERS_ALLOWED = 3  -- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ (‡∏£‡∏ß‡∏°‡πÄ‡∏£‡∏≤)

local function startPlayerMonitor()
    task.spawn(function()
        while autoFarm and _G.FARM_SCRIPT_RUNNING do
            task.wait(1)
            
            local playerCount = #Players:GetPlayers()
            
            -- ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà spam)
            if playerCount > 1 then
                -- ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏∑‡πà‡∏ô
                if playerCount <= MAX_PLAYERS_ALLOWED then
                    -- ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡∏Ñ‡∏ô - ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
                    print("üë• ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: " .. playerCount .. "/" .. MAX_PLAYERS_ALLOWED .. " - ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‚úÖ")
                else
                    -- ‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡∏Ñ‡∏ô - ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏´‡∏ô‡∏µ!
                    warn("‚ö†Ô∏è ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô! ‡∏û‡∏ö " .. playerCount .. " ‡∏Ñ‡∏ô")
                    warn("üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î (>" .. MAX_PLAYERS_ALLOWED .. " ‡∏Ñ‡∏ô)")
                    
                    -- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
                    for _, otherPlayer in pairs(Players:GetPlayers()) do
                        if otherPlayer ~= Player then
                            print("   üßë " .. otherPlayer.Name)
                        end
                    end
                    
                    warn("üèÉ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ß‡∏≤‡∏£‡πå‡∏õ...")
                    
                    -- üÜï ‡∏ö‡∏¥‡∏ô‡πÑ‡∏õ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏≤‡∏£‡πå‡∏õ (‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ô‡πà‡∏≤‡∏™‡∏á‡∏™‡∏±‡∏¢)
                    pcall(function()
                        local char = Player.Character
                        if char then
                            local hrp = char:FindFirstChild("HumanoidRootPart")
                            if hrp then
                                local currentPos = hrp.Position
                                
                                -- ‡∏ö‡∏¥‡∏ô‡πÑ‡∏õ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏™‡∏∏‡πà‡∏° 3-5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                                local moveCount = math.random(3, 5)
                                print("üîÑ ‡∏ö‡∏¥‡∏ô‡πÑ‡∏õ‡∏°‡∏≤ " .. moveCount .. " ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏≤‡∏£‡πå‡∏õ...")
                                
                                for i = 1, moveCount do
                                    -- ‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏Å‡∏•‡πâ‡πÜ
                                    local randomOffset = Vector3.new(
                                        math.random(-100, 100),
                                        math.random(-20, 20),
                                        math.random(-100, 100)
                                    )
                                    
                                    local targetPos = currentPos + randomOffset
                                    
                                    print("   ‚úàÔ∏è ‡∏ö‡∏¥‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà " .. i)
                                    flyToPosition(targetPos, flySpeed)
                                    
                                    -- ‡∏£‡∏≠‡∏™‡∏∏‡πà‡∏° 1-2 ‡∏ß‡∏¥
                                    task.wait(math.random(1, 2))
                                    
                                    -- ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                                    if hrp then
                                        currentPos = hrp.Position
                                    end
                                end
                                
                                print("‚úÖ ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏≤‡∏£‡πå‡∏õ!")
                            end
                        end
                    end)
                    
                    task.wait(2)
                    teleportToRandomWorld()
                    task.wait(10)
                end
            else
                -- ‡πÄ‡∏£‡∏≤ 1 ‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                print("üë§ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: 1 ‡∏Ñ‡∏ô (‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) ‚úÖ")
            end
            
            -- ‡∏•‡∏î spam - ‡∏£‡∏≠ 10 ‡∏ß‡∏¥‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏´‡∏°‡πà
            task.wait(10)
        end
    end)
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡πÇ‡∏•‡∏Å
----------------------------------------------------------------
local function startWorldChecker()
    task.spawn(function()
        while autoFarm and _G.FARM_SCRIPT_RUNNING do
            task.wait(2)
            
            local currentPlace = game.PlaceId
            
            if currentPlace == FARM_WORLD then
                if checkInventoryForSell() then
                    print("üì¶ ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÄ‡∏ï‡πá‡∏°!")
                    print("üí∞ ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏Ç‡∏≤‡∏¢...")
                    task.wait(2)
                    teleportToWorld(SELL_WORLD)
                    task.wait(10)
                end
            elseif currentPlace == SELL_WORLD then
                print("üí∞ ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á...")
                task.wait(2)
                sellAllItems()
                task.wait(3)
                print("üîÑ ‡∏Å‡∏•‡∏±‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°...")
                teleportToWorld(FARM_WORLD)
                task.wait(10)
            else
                warn("üö´ ‡∏ô‡∏≠‡∏Å‡πÇ‡∏•‡∏Å!")
                warn("üìç PlaceId: " .. currentPlace)
                warn("üîÑ ‡∏Å‡∏•‡∏±‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°...")
                task.wait(2)
                teleportToWorld(FARM_WORLD)
                task.wait(10)
            end
        end
    end)
end

----------------------------------------------------------------
-- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
----------------------------------------------------------------
local function showStatus()
    task.spawn(function()
        while autoFarm and _G.FARM_SCRIPT_RUNNING do
            task.wait(10)
            
            pcall(function()
                local currentPlace = game.PlaceId
                local playerCount = #Players:GetPlayers()
                local resources = Player:WaitForChild("Data", 5):WaitForChild("Resources", 5)
                
                local spirit = resources:FindFirstChild("Spiritwood") and resources.Spiritwood.Value or 0
                local lime = resources:FindFirstChild("Limestone") and resources.Limestone.Value or 0
                local crystal = resources:FindFirstChild("MistCrystal") and resources.MistCrystal.Value or 0
                
                print("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")
                print("üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:")
                print("   üåç ‡πÇ‡∏•‡∏Å: " .. currentPlace)
                print("   üë• ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: " .. playerCount)
                print("   ü™µ Spiritwood: " .. spirit)
                print("   ü™® Limestone: " .. lime)
                print("   üíé MistCrystal: " .. crystal)
                print("   üîç ‡∏ï‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á: " .. stuckCount .. "/" .. MAX_STUCK_COUNT)
                print("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")
            end)
        end
    end)
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
----------------------------------------------------------------
local function TouchFoodModel(model)
    if not model or not model:IsA("Model") then return false end
    
    local handle = model:FindFirstChild("Handle")
    if not handle or not handle:FindFirstChildOfClass("TouchTransmitter") then return false end
    
    local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return false end
    
    pcall(function()
        firetouchinterest(handle, hrp, 0)
        task.wait(0.05)
        firetouchinterest(handle, hrp, 1)
    end)
    
    return true
end

local function getAllDroppedItems()
    local items = {}
    local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return items end
    
    local function scan(parent)
        if not parent then return end
        pcall(function()
            for _, obj in pairs(parent:GetChildren()) do
                if table.find(itemNames, obj.Name) then
                    local pos = nil
                    if obj:IsA("BasePart") then
                        pos = obj.Position
                    elseif obj:IsA("Model") and obj.PrimaryPart then
                        pos = obj.PrimaryPart.Position
                    end
                    
                    if pos and (pos - hrp.Position).Magnitude <= scanRange then
                        table.insert(items, {instance = obj, pos = pos, distance = (pos - hrp.Position).Magnitude})
                    end
                end
            end
        end)
    end
    
    scan(workspace)
    scan(workspace:FindFirstChild("Camera"))
    
    table.sort(items, function(a, b) return a.distance < b.distance end)
    return items
end

local function collectAllItems()
    print("üß≤ ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°...")
    local collectedCount = 0
    local maxAttempts = 10
    local attempts = 0
    
    updateLastAction()
    
    while attempts < maxAttempts and autoFarm and _G.FARM_SCRIPT_RUNNING do
        local items = getAllDroppedItems()
        
        if #items == 0 then
            print("‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°")
            break
        end
        
        print("üîç ‡∏û‡∏ö " .. #items .. " ‡∏ä‡∏¥‡πâ‡∏ô")
        
        for _, itemData in ipairs(items) do
            if itemData.instance and itemData.instance.Parent then
                TouchFoodModel(itemData.instance)
                task.wait(0.1)
                collectedCount = collectedCount + 1
            end
        end
        
        attempts = attempts + 1
        task.wait(0.5)
    end
    
    if collectedCount > 0 then
        print("‚ú® ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à: " .. collectedCount .. " ‡∏Ñ‡∏£‡∏±‡πâ‡∏á")
        updateLastAction()
    end
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏≤‡∏°‡∏±‡∏á‡∏Å‡∏£
----------------------------------------------------------------
function GetMountedDragon()
    local char = Player.Character
    if not char then return nil end
    
    local Dragons = char:FindFirstChild("Dragons")
    if not Dragons then return nil end
    
    for _, dragon in pairs(Dragons:GetChildren()) do
        local Seat = dragon:FindFirstChildWhichIsA("VehicleSeat") or dragon:FindFirstChild("Seat")
        if Seat and Seat.Occupant and Seat.Occupant.Parent == char then
            return dragon
        end
    end
    return nil
end

function findNearestNode()
    local nodesFolder = workspace:FindFirstChild("Interactions") 
        and workspace.Interactions:FindFirstChild("Nodes") 
        and workspace.Interactions.Nodes:FindFirstChild("Resources")
    
    if not nodesFolder then return nil end
    
    local nearest = nil
    local minDist = math.huge
    local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end
    
    for _, node in pairs(nodesFolder:GetChildren()) do
        local hp = node:FindFirstChild("BillboardPart") 
            and node.BillboardPart:FindFirstChild("Health")
        
        if hp and hp.Value > 0 then
            local nodePos = node.BillboardPart.Position

            if not isInNoGoZone(nodePos) then
                local dist = (nodePos - hrp.Position).Magnitude

                if dist < minDist then
                    minDist = dist
                    nearest = node.BillboardPart
                end
            end
        end
    end
    
    return nearest
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏¥‡∏ô
----------------------------------------------------------------
function flyToPosition(targetPos, speed)
    speed = speed or flySpeed
    updateLastAction()

    Character = Player.Character
    HRP = Character and Character:FindFirstChild("HumanoidRootPart")

    if not Character or not HRP then
        warn("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£")
        return false
    end

    setNoclip(true)

    local startTime = tick()
    local maxTime = (targetPos - HRP.Position).Magnitude / speed + 5
    local connection

    local function stopFlying()
        if connection then
            connection:Disconnect()
            connection = nil
        end
        setNoclip(false)
    end

    connection = RunService.Heartbeat:Connect(function(deltaTime)
        if not HRP or not HRP.Parent then
            stopFlying()
            return
        end

        local currentPos = HRP.Position
        local distanceToTarget = (targetPos - currentPos).Magnitude

        if distanceToTarget <= 8 then
            stopFlying()
            return
        end

        if tick() - startTime > maxTime then
            stopFlying()
            return
        end

        local direction = (targetPos - currentPos).Unit
        local moveDistance = speed * deltaTime
        local newPos = currentPos + (direction * moveDistance)

        HRP.CFrame = CFrame.lookAt(newPos, targetPos)
        HRP.Velocity = Vector3.zero
        HRP.AssemblyLinearVelocity = Vector3.zero
    end)

    repeat
        task.wait()
    until not connection or (HRP.Position - targetPos).Magnitude <= 8

    stopFlying()
    updateLastAction()
    task.wait(0.2)
    return true
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏° (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á)
----------------------------------------------------------------
function startFarm()
    print("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°!")
    
    if farmCoroutine then
        pcall(function()
            coroutine.close(farmCoroutine)
        end)
    end
    
    farmLoopActive = true
    
    farmCoroutine = task.spawn(function()
        print("‚úÖ Loop ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
        
        while autoFarm and farmLoopActive and _G.FARM_SCRIPT_RUNNING do
            pcall(function()
                -- ‡πÄ‡∏ä‡πá‡∏Ñ‡πÇ‡∏•‡∏Å
                if game.PlaceId ~= FARM_WORLD then
                    warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°")
                    task.wait(5)
                    return
                end
                
                local dragon = GetMountedDragon()
                
                if not dragon then
                    warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏°‡∏±‡∏á‡∏Å‡∏£!")
                    task.wait(2)
                else
                    local targetNode = findNearestNode()
                    
                    if targetNode then
                        local nodePos = targetNode.Position
                        
                        print("üå≥ ‡∏û‡∏ö‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ!")
                        print("‚úàÔ∏è ‡∏ö‡∏¥‡∏ô...")
                        flyToPosition(nodePos + Vector3.new(0, 15, 0), flySpeed)
                        
                        updateLastAction()
                        task.wait(0.3)
                        
                        print("üî• ‡πÇ‡∏à‡∏°‡∏ï‡∏µ...")
                        local attackCount = 0
                        while targetNode and targetNode:FindFirstChild("Health") 
                            and targetNode.Health.Value > 0 
                            and autoFarm and farmLoopActive and _G.FARM_SCRIPT_RUNNING 
                            and attackCount < 100 do -- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á
                            
                            if dragon and dragon:FindFirstChild("Remotes") then
                                local remotes = dragon.Remotes
                                
                                pcall(function()
                                    if remotes:FindFirstChild("BreathFireRemote") then
                                        remotes.BreathFireRemote:FireServer()
                                    end
                                end)
                                
                                pcall(function()
                                    if remotes:FindFirstChild("PlaySoundRemote") then
                                        local args = {"Breath", "Destructibles", targetNode}
                                        remotes.PlaySoundRemote:FireServer(unpack(args))
                                    end
                                end)
                            end
                            
                            updateLastAction()
                            attackCount = attackCount + 1
                            task.wait(attackDelay)
                        end
                        
                        print("‚úÖ ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏û‡∏±‡∏á!")
                        task.wait(1)
                        collectAllItems()
                        task.wait(1)
                        
                    else
                        print("üîç ‡∏´‡∏≤‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ...")
                        local nextPos = checkPositions[currentPatrolIndex]

                        if not isInNoGoZone(nextPos) then
                            flyToPosition(nextPos, flySpeed + 20)
                        else
                            print("üö´ ‡∏Ç‡πâ‡∏≤‡∏° zone ‡∏´‡πâ‡∏≤‡∏°")
                        end

                        currentPatrolIndex = currentPatrolIndex + 1
                        if currentPatrolIndex > #checkPositions then
                            currentPatrolIndex = 1
                        end

                        task.wait(2)
                    end
                end
            end)
            
            task.wait(0.5)
        end
        
        farmLoopActive = false
        print("‚ö†Ô∏è ‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏´‡∏¢‡∏∏‡∏î")
    end)
    
    print("‚úÖ startFarm() ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô")
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏±‡∏á‡∏Å‡∏£ (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á - ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ WaitForChild ‡∏ô‡∏≤‡∏ô)
----------------------------------------------------------------
local function setupDragonSystem()
    print("üêâ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏á‡∏Å‡∏£...")
    
    task.spawn(function()
        pcall(function()
            -- ‡∏£‡∏≠ Character
            local char = Player.Character
            if not char then
                print("‚è≥ ‡∏£‡∏≠ Character...")
                char = Player.CharacterAdded:Wait()
                task.wait(2)
            end
            
            local remotes = ReplicatedStorage:FindFirstChild("Remotes")
            if not remotes then
                warn("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö Remotes")
                return
            end
            
            -- ‡∏´‡∏≤ Dragon folder
            local dragonFolder = nil
            pcall(function()
                dragonFolder = workspace:WaitForChild("Characters", 10)
                    :WaitForChild(Player.Name, 10)
                    :WaitForChild("Dragons", 10)
            end)
            
            if not dragonFolder then
                warn("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö Dragons folder")
                return
            end
            
            print("‚úÖ ‡∏û‡∏ö Dragons folder")
            
            local function getAutoDragon()
                local dragons = dragonFolder:GetChildren()
                if #dragons > 0 then
                    return dragons[1]
                end
                return nil
            end
            
            local function reviveDragon(dragonModel)
                pcall(function()
                    local dragonName = dragonModel.Name
                    local deadFlag = dragonModel:FindFirstChild("Data") 
                        and dragonModel.Data:FindFirstChild("Dead")

                    if deadFlag and deadFlag.Value == true then
                        print("üíÄ ‡∏ü‡∏∑‡πâ‡∏ô‡∏°‡∏±‡∏á‡∏Å‡∏£:", dragonName)
                        local args = { dragonName, "DragonRevivalHeart" }
                        remotes:FindFirstChild("ReviveDragonRemote"):InvokeServer(unpack(args))
                        task.wait(1)
                    end
                end)
            end
            
            local function ensureMountedDragon()
                pcall(function()
                    local dragonModel = getAutoDragon()
                    if not dragonModel then return end
                    
                    local targetName = dragonModel.Name
                    reviveDragon(dragonModel)
                    
                    local humanoid = char:FindFirstChildOfClass("Humanoid")
                    local currentSeat = humanoid and humanoid.SeatPart
                    local currentMount = currentSeat and currentSeat:FindFirstAncestorWhichIsA("Model")
                    
                    if currentMount and currentMount:IsDescendantOf(dragonFolder) 
                        and currentMount.Name == targetName then
                        return
                    end
                    
                    local seat = dragonModel:FindFirstChildWhichIsA("Seat", true)
                    if seat and humanoid then
                        seat:Sit(humanoid)
                        print("ü™∂ ‡∏Ç‡∏µ‡πà‡∏°‡∏±‡∏á‡∏Å‡∏£:", targetName)
                        
                        task.wait(1)
                        pcall(function()
                            local flyBtn = Player.PlayerGui
                                :WaitForChild("HUDGui", 5)
                                .BottomFrame.CurrentDragonFrame
                                .DragonControlsFrame.Other:FindFirstChild("Fly")
                            
                            if flyBtn and flyBtn:FindFirstChild("MouseButton1Down") then
                                firesignal(flyBtn.MouseButton1Down)
                                print("üõ´ ‡∏ö‡∏¥‡∏ô!")
                            end
                        end)
                    end
                end)
            end
            
            -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ã‡πâ‡∏≥
            task.spawn(function()
                while _G.FARM_SCRIPT_RUNNING do
                    task.wait(2) -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥
                    pcall(ensureMountedDragon)
                end
            end)
            
            Player.CharacterAdded:Connect(function(newChar)
                task.wait(3)
                char = newChar
                pcall(ensureMountedDragon)
            end)
            
            print("‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏±‡∏á‡∏Å‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏°")
        end)
    end)
end

----------------------------------------------------------------
-- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏î Q
----------------------------------------------------------------
local function setupAutoFlyControl()
    print("‚å®Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏° Q...")
    
    task.spawn(function()
        pcall(function()
            -- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ FlyControlUseSpace
            task.wait(2)
            pcall(function()
                local settings = Player:WaitForChild("Data", 10):WaitForChild("Settings", 10)
                local flyControl = settings:FindFirstChild("FlyControlUseSpace")
                if flyControl then
                    flyControl.Value = false
                    print("‚úÖ FlyControlUseSpace = false")
                end
            end)
            
            local function pressQ()
                pcall(function()
                    local VIM = game:GetService("VirtualInputManager")
                    VIM:SendKeyEvent(true, Enum.KeyCode.Q, false, game)
                    task.wait(0.05)
                    VIM:SendKeyEvent(false, Enum.KeyCode.Q, false, game)
                end)
            end
            
            local function getDragonFlying()
                local result = false
                pcall(function()
                    local char = Player.Character
                    if not char then return end
                    
                    local dragons = char:FindFirstChild("Dragons")
                    if not dragons then return end
                    
                    for _, dragon in ipairs(dragons:GetChildren()) do
                        if dragon:IsA("Model") then
                            local data = dragon:FindFirstChild("Data")
                            if data then
                                local flying = data:FindFirstChild("Flying")
                                if flying then
                                    result = flying.Value
                                    return
                                end
                            end
                        end
                    end
                end)
                return result
            end
            
            -- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Ñ
            task.wait(3)
            while _G.FARM_SCRIPT_RUNNING do
                task.wait(0.5)
                
                local isFlying = getDragonFlying()
                
                if not isFlying then
                    print("‚ö†Ô∏è ‡∏°‡∏±‡∏á‡∏Å‡∏£‡πÑ‡∏°‡πà‡∏ö‡∏¥‡∏ô ‚Üí Q")
                    pressQ()
                    task.wait(0.1)
                    pressQ()
                end
            end
        end)
    end)
    
    print("‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö Q ‡∏û‡∏£‡πâ‡∏≠‡∏°")
end

----------------------------------------------------------------
-- üé¨ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö (‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
----------------------------------------------------------------

print("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")
print("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö...")
print("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")

-- 1. Anti-AFK
setupAntiAFK()

-- 2. GUI
createGUI()

-- 3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏±‡∏á‡∏Å‡∏£ (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö async)
setupDragonSystem()

-- 4. ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏î Q (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö async)
setupAutoFlyControl()

-- 5. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á
startStuckDetection()

-- ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°
print("‚è≥ ‡∏£‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏´‡∏•‡∏î 5 ‡∏ß‡∏¥...")
task.wait(5)

-- ‡πÄ‡∏ä‡πá‡∏Ñ‡πÇ‡∏•‡∏Å
local currentPlace = game.PlaceId
print("üìç PlaceId: " .. currentPlace)

if currentPlace == FARM_WORLD then
    print("‚úÖ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°")
    
    -- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    print("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°...")
    startFarm()
    
    print("üë• ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô...")
    startPlayerMonitor()
    
    print("üó∫Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡πÇ‡∏•‡∏Å...")
    startWorldChecker()
    
    print("üìä ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...")
    showStatus()
    
elseif currentPlace == SELL_WORLD then
    print("üí∞ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ç‡∏≤‡∏¢")
    task.wait(2)
    sellAllItems()
    task.wait(3)
    teleportToWorld(FARM_WORLD)
    
else
    print("üåç ‡∏ô‡∏≠‡∏Å‡πÇ‡∏•‡∏Å - ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏Å‡∏•‡∏±‡∏ö")
    task.wait(2)
    teleportToWorld(FARM_WORLD)
end

print("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")
print("‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!")
print("üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á: ‡πÄ‡∏õ‡∏¥‡∏î")
print("üõ°Ô∏è ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥: ‡πÄ‡∏õ‡∏¥‡∏î")
print("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")
